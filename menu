#!/bin/bash
# This is /usr/local/bin/menu - Your custom Matrix interactive menu

show_menu() {
    clear
    echo -e "\033[1;32m===================================\033[0m"
    echo -e "\033[1;32m     Welcome to the Matrix Menu!   \033[0m"
    echo -e "\033[1;32m===================================\033[0m"
    echo -e "\033[1;37m Your IP: $(hostname -I | awk '{print $1}')\033[0m"
    if [[ -f "/etc/.domain" ]]; then
      echo -e "\033[1;37m Your Domain: $(cat /etc/.domain)\033[0m"
    fi
    echo ""
    echo -e "\033[1;33mChoose an option:\033[0m"
    echo -e "\033[1;36m1) Create a new SSH User\033[0m"
    echo -e "\033[1;36m2) Manage Nginx\033[0m"
    echo -e "\033[1;36m3) Show System Information\033[0m"
    echo -e "\033[1;31m4) Exit Menu\033[0m"
    echo ""
    echo -ne "\033[1;37mEnter your choice [1-4]: \033[0m"
}

create_ssh_user() {
    clear
    echo -e "\033[1;32m--- Create New SSH User ---\033[0m"
    read -p "Enter username: " username
    read -s -p "Enter password for $username: " password
    echo ""
    sudo adduser "$username" --gecos "" --disabled-password
    echo "$username:$password" | sudo chpasswd
    echo -e "\033[1;32mUser $username created successfully!\033[0m"
    read -n 1 -s -r -p "Press any key to return to menu..."
}

manage_nginx() {
    clear
    echo -e "\033[1;32m--- Nginx Management ---\033[0m"
    echo -e "\033[1;36m1) Start Nginx\033[0m"
    echo -e "\033[1;36m2) Stop Nginx\033[0m"
    echo -e "\033[1;36m3) Restart Nginx\033[0m"
    echo -e "\033[1;36m4) Check Nginx Status\033[0m"
    echo -e "\033[1;31m5) Back to Main Menu\033[0m"
    echo ""
    read -ne "\033[1;37mEnter your choice [1-5]: \033[0m" nginx_choice
    case "$nginx_choice" in
        1) sudo systemctl start nginx ;;
        2) sudo systemctl stop nginx ;;
        3) sudo systemctl restart nginx ;;
        4) sudo systemctl status nginx ;;
        5) return ;;
        *) echo -e "\033[1;31mInvalid choice.\033[0m" ;;
    esac
    read -n 1 -s -r -p "Press any key to continue..."
}

show_sys_info() {
    clear
    echo -e "\033[1;32m--- System Information ---\033[0m"
    echo "Hostname: $(hostname)"
    echo "OS: $(lsb_release -ds 2>/dev/null || cat /etc/os-release | grep PRETTY_NAME | cut -d'=' -f2 | tr -d '"')"
    echo "Kernel: $(uname -r)"
    echo "CPU: $(grep -m 1 'model name' /proc/cpuinfo | cut -d: -f2)"
    echo "Memory: $(free -h | awk '/^Mem:/ {print $2}')"
    echo "Disk: $(df -h / | awk 'NR==2 {print $2 " used, " $4 " free"}')"
    read -n 1 -s -r -p "Press any key to return to menu..."
}

while true; do
    show_menu
    read -r choice
    case "$choice" in
        1) create_ssh_user ;;
        2) manage_nginx ;;
        3) show_sys_info ;;
        4) echo -e "\033[1;32mExiting Matrix Menu. Goodbye!\033[0m"; break ;;
        *) echo -e "\033[1;31mInvalid option. Please try again.\033[0m"; sleep 1 ;;
    esac
done
